<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyFinances - Qu·∫£n l√Ω n·ª£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col md:flex-row overflow-hidden">

    <div id="auth-modal" class="fixed inset-0 bg-slate-900 z-[200] flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
            <h1 class="text-3xl font-bold text-center text-blue-600 mb-2"><i class="fa-solid fa-sack-dollar"></i> MyFinances</h1>
            <p class="text-slate-500 text-sm text-center mb-6">ƒêƒÉng nh·∫≠p ƒë·ªÉ ƒë·ªìng b·ªô d·ªØ li·ªáu</p>
            
            <div id="auth-error" class="hidden bg-red-50 text-red-500 text-sm p-3 rounded-lg mb-4 text-center"></div>

            <form onsubmit="handleAuth(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">Email</label>
                    <input type="email" id="auth-email" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500" placeholder="name@example.com" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">M·∫≠t kh·∫©u</label>
                    <input type="password" id="auth-pass" autocomplete="current-password" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" id="btn-auth" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg transition-transform active:scale-95">
                    ƒêƒÉng nh·∫≠p
                </button>
            </form>

            <div class="mt-6 text-center text-sm">
                <button onclick="toggleAuthMode()" id="link-auth" class="text-blue-600 font-bold hover:underline">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</button>
            </div>
        </div>
    </div>

    <aside class="hidden md:flex flex-col w-64 bg-white border-r h-full p-6">
        <h1 class="text-2xl font-bold text-blue-600 mb-8"><i class="fa-solid fa-sack-dollar"></i> MyFinances</h1>
        <nav class="space-y-2">
            <button onclick="switchTab('dashboard')" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-blue-50 text-slate-600 hover:text-blue-600 font-medium" data-target="dashboard">
                <i class="fa-solid fa-chart-pie w-6"></i> T·ªïng quan
            </button>
            <button onclick="switchTab('debts')" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-blue-50 text-slate-600 hover:text-blue-600 font-medium" data-target="debts">
                <i class="fa-solid fa-credit-card w-6"></i> Qu·∫£n l√Ω N·ª£
            </button>
            <button onclick="switchTab('budget')" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-blue-50 text-slate-600 hover:text-blue-600 font-medium" data-target="budget">
                <i class="fa-solid fa-wallet w-6"></i> Thu Chi
            </button>
            <button onclick="switchTab('goals')" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-blue-50 text-slate-600 hover:text-blue-600 font-medium" data-target="goals">
                <i class="fa-solid fa-bullseye w-6"></i> M·ª•c ti√™u
            </button>
            <button onclick="switchTab('account')" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-blue-50 text-slate-600 hover:text-blue-600 font-medium" data-target="account">
                <i class="fa-solid fa-user-gear w-6"></i> T√†i kho·∫£n
            </button>
        </nav>
    </aside>

    <main class="flex-1 overflow-y-auto p-4 md:p-8 relative pb-20 md:pb-8" id="main-container">
        
        <div id="dashboard" class="tab-content active pb-24">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">T·ªïng quan</h2>
                    <p id="daily-insight" class="text-xs text-slate-500 mt-1">‚ú® H√¥m nay b·∫°n ch∆∞a c√≥ giao d·ªãch n√†o.</p>
                </div>
                <div class="text-right">
                    <span class="text-[10px] font-bold bg-orange-100 text-orange-600 px-2 py-1 rounded-full uppercase tracking-wide">Survival Mode</span>
                    <div class="text-[10px] text-slate-400 mt-1">∆Øu ti√™n thi·∫øt y·∫øu</div>
                </div>
            </div>
            
            <div class="bg-white p-4 rounded-2xl shadow-sm border mb-4 relative overflow-hidden">
                <div class="flex justify-between items-end mb-2">
                    <div>
                        <div class="text-xs text-slate-400 uppercase font-bold">C√≤n l·∫°i tu·∫ßn n√†y</div>
                        <div class="text-2xl font-bold text-blue-600" id="weekly-remain">1.500.000 ‚Ç´</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-slate-400">ƒê√£ ti√™u</div>
                        <div class="font-bold text-slate-700" id="weekly-spent">0 ‚Ç´</div>
                    </div>
                </div>
                <div class="w-full bg-slate-100 rounded-full h-2 mb-2 overflow-hidden">
                    <div id="weekly-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-[10px] text-slate-400 font-medium">
                    <span>M·ª•c ti√™u: 1.500.000 ‚Ç´</span>
                    <span id="daily-avg">TB: 214k/ng√†y</span>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <button onclick="setType('expense'); openQuickAdd()" class="bg-red-50 hover:bg-red-100 p-3 rounded-xl flex flex-col items-center gap-1 transition-colors">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-red-500 shadow-sm"><i class="fa-solid fa-minus"></i></div>
                    <span class="text-xs font-bold text-red-700">Chi ti√™u</span>
                </button>
                <button onclick="setType('income'); openQuickAdd()" class="bg-green-50 hover:bg-green-100 p-3 rounded-xl flex flex-col items-center gap-1 transition-colors">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-green-500 shadow-sm"><i class="fa-solid fa-plus"></i></div>
                    <span class="text-xs font-bold text-green-700">Thu nh·∫≠p</span>
                </button>
                <button onclick="switchTab('debts')" class="bg-blue-50 hover:bg-blue-100 p-3 rounded-xl flex flex-col items-center gap-1 transition-colors">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-blue-500 shadow-sm"><i class="fa-solid fa-building-columns"></i></div>
                    <span class="text-xs font-bold text-blue-700">Tr·∫£ n·ª£</span>
                </button>
            </div>
            
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 text-white p-5 rounded-2xl shadow-lg mb-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-white/5 rounded-full blur-2xl -mr-10 -mt-10"></div>
                <div class="flex gap-4 items-center relative z-10">
                    <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-xl"><i class="fa-solid fa-robot"></i></div>
                    <div class="flex-1">
                        <div class="text-xs font-bold text-slate-400 uppercase mb-1">AI Ph√¢n t√≠ch</div>
                        <p id="health-msg" class="text-sm font-medium leading-tight">D·ªØ li·ªáu ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω...</p>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-2xl shadow-sm border">
                    <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase">T√†i s·∫£n r√≤ng</h3>
                    <div id="chart-asset-container" class="relative h-48"><canvas id="chartAssets"></canvas></div>
                    <div id="no-debt-view" class="hidden text-center py-6">
                        <div class="text-3xl font-bold text-blue-600 mb-1" id="dash-asset">0 ‚Ç´</div>
                        <div class="text-xs text-slate-400">T·ªïng t√†i s·∫£n hi·ªán c√≥</div>
                        <div class="mt-4 inline-block bg-green-50 text-green-700 px-3 py-1 rounded-full text-xs font-bold">‚ú® B·∫°n kh√¥ng c√≥ kho·∫£n n·ª£ n√†o!</div>
                    </div>
                </div>
                <div class="bg-white p-5 rounded-2xl shadow-sm border">
                    <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase">Ph√¢n b·ªï d√≤ng ti·ªÅn</h3>
                    <div class="relative h-40 mb-4 flex justify-center"><canvas id="chartExpense"></canvas></div>
                    <div id="expense-legend" class="space-y-2 text-xs"></div>
                </div>
            </div>
        </div>

        
        <div id="debts" class="tab-content">
            <div class="flex justify-between items-end mb-4">
                <h2 class="text-2xl font-bold">Qu·∫£n l√Ω Kho·∫£n vay</h2>
            </div>
            
            <div class="grid grid-cols-3 gap-2 mb-6">
                <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-red-500">
                    <div class="text-[10px] text-slate-400 uppercase font-bold">T·ªïng n·ª£ g·ªëc</div>
                    <div class="text-sm md:text-xl font-bold text-red-600 mt-1 truncate" id="total-debt">0 ‚Ç´</div>
                </div>
                <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-orange-500">
                    <div class="text-[10px] text-slate-400 uppercase font-bold">Tr·∫£ th√°ng n√†y</div>
                    <div class="text-sm md:text-xl font-bold text-orange-600 mt-1 truncate" id="monthly-pay">0 ‚Ç´</div>
                </div>
                <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-blue-500">
                    <div class="text-[10px] text-slate-400 uppercase font-bold">H·∫°n g·∫ßn nh·∫•t</div>
                    <div class="text-sm md:text-xl font-bold text-blue-600 mt-1 truncate" id="next-due-date">--/--</div>
                </div>
            </div>

            <div id="debt-strategy-box" class="hidden mb-4 bg-blue-50 p-3 rounded-xl flex justify-between items-center border border-blue-100">
                <div>
                    <div class="text-xs font-bold text-blue-800 uppercase mb-1">Chi·∫øn l∆∞·ª£c ∆∞u ti√™n</div>
                    <div class="text-sm text-blue-600" id="strategy-name">Snowball (Tr·∫£ n·ª£ nh·ªè tr∆∞·ªõc)</div>
                </div>
                <button onclick="toggleStrategy()" class="bg-white text-blue-600 text-xs font-bold px-3 py-2 rounded-lg border hover:bg-blue-100 shadow-sm">ƒê·ªïi chi·∫øn l∆∞·ª£c</button>
            </div>

            <div id="debt-empty" class="hidden flex flex-col items-center justify-center py-10 text-center">
                <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center text-4xl text-slate-300 mb-4"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                <h3 class="font-bold text-slate-600 mb-1">B·∫°n ch∆∞a c√≥ kho·∫£n vay n√†o</h3>
                <p class="text-xs text-slate-400 mb-4 max-w-xs">Th√™m kho·∫£n vay ƒë·ªÉ theo d√µi d∆∞ n·ª£ v√† nh·∫≠n nh·∫Øc nh·ªü tr·∫£ ti·ªÅn ƒë√∫ng h·∫°n.</p>
                <button onclick="openModal()" class="text-blue-600 font-bold text-sm hover:underline">+ Th√™m kho·∫£n vay ƒë·∫ßu ti√™n</button>
            </div>

            <div id="debt-list" class="space-y-3 pb-24"></div>
        </div>

        <div id="goals" class="tab-content">
            <h2 class="text-2xl font-bold mb-4">M·ª•c ti√™u Ti·∫øt ki·ªám</h2>
            <form onsubmit="handleAddGoal(event)" class="flex gap-2 mb-6">
                <input type="text" id="goalName" placeholder="M·ª•c ti√™u (vd: Mua iPhone)" class="flex-1 p-3 border rounded-xl outline-none focus:ring-2 ring-blue-100" required>
                <input type="number" id="goalTarget" placeholder="C·∫ßn c√≥ (VNƒê)" class="w-1/3 p-3 border rounded-xl outline-none font-bold text-right" required>
                <button type="submit" class="bg-indigo-600 text-white px-4 rounded-xl hover:bg-indigo-700"><i class="fa-solid fa-plus"></i></button>
            </form>
            <div id="goal-list" class="grid md:grid-cols-2 gap-4 pb-20"></div>
        </div>

        <div id="account" class="tab-content">
            <div class="flex items-center gap-4 mb-6 pt-4">
                <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-2xl"><i class="fa-solid fa-user-astronaut"></i></div>
                <div>
                    <h2 class="text-xl font-bold text-slate-800" id="acc-email">ƒêang t·∫£i...</h2>
                    <div class="text-xs text-slate-500"><span id="acc-tx-count">0</span> giao d·ªãch ‚Ä¢ MyFinances v2.2</div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-2xl shadow-sm border mb-4">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-slate-700">ƒê·ªìng b·ªô V√≠ th·ª±c t·∫ø</h3>
                    <span id="sync-status" class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded-full">Cloud OK</span>
                </div>
                <p class="text-xs text-slate-400 mb-4 bg-slate-50 p-2 rounded-lg">‚ÑπÔ∏è Nh·∫≠p s·ªë ti·ªÅn b·∫°n ƒëang th·ª±c s·ª± c√≥. App s·∫Ω t·ª± t·∫°o giao d·ªãch ƒëi·ªÅu ch·ªânh ƒë·ªÉ kh·ªõp s·ªë d∆∞.</p>
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-center px-2">
                        <span class="text-xs font-bold text-slate-500 uppercase">Tr√™n App ƒëang ghi nh·∫≠n</span>
                        <span class="font-bold text-blue-600 text-lg" id="acc-app-balance">0 ‚Ç´</span>
                    </div>
                    <div class="flex gap-2">
                         <input type="text" inputmode="numeric" oninput="formatRealBal(this)" id="realBalance" placeholder="VD: 1.500.000" class="flex-1 p-3 border-2 border-slate-100 rounded-xl font-bold text-slate-700 outline-none focus:border-blue-500 transition-colors">
                         <button onclick="handleAdjustBalance()" id="btn-sync-bal" disabled class="bg-slate-200 text-slate-400 px-5 rounded-xl font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm"><i class="fa-solid fa-check"></i></button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border overflow-hidden mb-6">
                <button onclick="exportCSV()" class="w-full flex items-center p-4 hover:bg-slate-50 border-b border-slate-100 text-left text-slate-700 font-medium transition-colors"><i class="fa-solid fa-file-excel text-green-600 w-8 text-center"></i> Xu·∫•t d·ªØ li·ªáu Excel</button>
                <button onclick="logout()" class="w-full flex items-center p-4 hover:bg-red-50 text-left text-red-600 font-medium transition-colors"><i class="fa-solid fa-right-from-bracket w-8 text-center"></i> ƒêƒÉng xu·∫•t t√†i kho·∫£n</button>
            </div>

            <div class="text-center">
                <p class="text-xs font-bold text-slate-300 uppercase mb-2">V√πng nguy hi·ªÉm</p>
                <div class="flex justify-center gap-4">
                     <button onclick="clearTransactions()" class="text-xs text-orange-400 hover:text-orange-600 hover:underline">X√≥a l·ªãch s·ª≠ giao d·ªãch</button>
                     <button onclick="resetApp()" class="text-xs text-red-400 hover:text-red-600 hover:underline">Reset App (X√≥a h·∫øt)</button>
                </div>
            </div>
            <div class="h-20"></div>
        </div>

        <div id="budget" class="tab-content">
            <h2 class="text-2xl font-bold mb-4">S·ªï Thu Chi</h2>
            <div class="bg-gradient-to-r from-blue-600 to-blue-500 text-white p-6 rounded-2xl shadow-lg mb-6">
                <div class="text-sm opacity-80 mb-1">S·ªë d∆∞ hi·ªán t·∫°i</div><div class="text-3xl font-bold" id="wallet-balance">0 ‚Ç´</div>
                <div class="flex mt-4 pt-4 border-t border-white/20">
                    <div class="flex-1"><div class="text-xs opacity-80"><i class="fa-solid fa-arrow-down"></i> Thu v√†o</div><div class="font-bold text-lg" id="total-income">0 ‚Ç´</div></div>
                    <div class="flex-1 border-l border-white/20 pl-4"><div class="text-xs opacity-80"><i class="fa-solid fa-arrow-up"></i> Chi ra</div><div class="font-bold text-lg" id="total-expense">0 ‚Ç´</div></div>
                </div>
            </div>

            <form onsubmit="handleAddTransaction(event)" id="budget-form" class="bg-white p-5 rounded-2xl shadow-sm border mb-6 relative">
                <div class="flex bg-slate-100 p-1 rounded-xl mb-6 select-none">
                    <input type="hidden" id="transType" value="expense">
                    <button type="button" onclick="setType('expense')" id="btn-expense" class="flex-1 py-2 rounded-lg font-bold text-sm transition-all shadow bg-white text-red-600">üî¥ Chi ti√™u</button>
                    <button type="button" onclick="setType('income')" id="btn-income" class="flex-1 py-2 rounded-lg font-bold text-sm text-slate-500 transition-all hover:bg-white/50">üü¢ Thu nh·∫≠p</button>
                </div>

                <div class="text-center mb-6">
                    <div class="relative inline-block w-full">
                        <input type="text" inputmode="numeric" id="transAmount" oninput="onAmountInput(this)" placeholder="0" class="w-full text-center text-4xl font-bold text-slate-800 outline-none placeholder:text-slate-200 bg-transparent" autocomplete="off">
                        <span class="absolute right-0 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-sm">‚Ç´</span>
                    </div>
                    <div class="flex justify-center gap-2 mt-3 overflow-x-auto pb-1" id="quick-add-btns">
                        <button type="button" onclick="addQuick(10000)" class="px-3 py-1 bg-slate-50 text-slate-600 text-xs font-bold rounded-full border border-slate-200 active:scale-95">+10k</button>
                        <button type="button" onclick="addQuick(50000)" class="px-3 py-1 bg-slate-50 text-slate-600 text-xs font-bold rounded-full border border-slate-200 active:scale-95">+50k</button>
                        <button type="button" onclick="addQuick(100000)" class="px-3 py-1 bg-slate-50 text-slate-600 text-xs font-bold rounded-full border border-slate-200 active:scale-95">+100k</button>
                        <button type="button" onclick="addQuick(500000)" class="px-3 py-1 bg-slate-50 text-slate-600 text-xs font-bold rounded-full border border-slate-200 active:scale-95">+500k</button>
                    </div>
                </div>

                <div class="space-y-4">
                    <input type="hidden" id="transCat">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs font-bold text-slate-400 uppercase">Danh m·ª•c</label>
                            <span id="cat-hint" class="text-xs text-blue-600 font-medium">Ch·ªçn b√™n d∆∞·ªõi üëá</span>
                        </div>
                        <div id="cat-grid" class="grid grid-cols-4 gap-2 max-h-48 overflow-y-auto p-1"></div>
                    </div>
                    
                    <div class="flex gap-2">
                        <div class="w-1/3">
                            <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Ng√†y</label>
                            <input type="date" id="transDate" class="w-full p-2 bg-slate-50 border rounded-lg text-xs font-bold outline-none">
                        </div>
                        <div class="flex-1">
                            <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Ghi ch√∫</label>
                            <input type="text" id="transDesc" class="w-full p-2 bg-slate-50 border rounded-lg text-sm outline-none focus:bg-white focus:border-blue-500 transition-colors" placeholder="...">
                        </div>
                    </div>
                </div>

                <button type="submit" id="btn-save" disabled class="w-full mt-6 bg-slate-200 text-slate-400 py-3 rounded-xl font-bold transition-all disabled:cursor-not-allowed shadow-sm flex items-center justify-center gap-2">
                    <i class="fa-solid fa-check"></i> L∆∞u giao d·ªãch
                </button>
            </form>
            <div class="flex justify-between items-end mb-3">
                <h3 class="font-bold text-slate-700">L·ªãch s·ª≠ giao d·ªãch</h3>
                <div class="relative"><input type="text" id="searchTrans" onkeyup="renderBudget()" placeholder="T√¨m ki·∫øm..." class="bg-white border rounded-full px-3 py-1 text-sm outline-none focus:border-blue-500 w-32 focus:w-48 transition-all"><i class="fa-solid fa-magnifying-glass absolute right-3 top-1.5 text-slate-400 text-xs"></i></div>
            </div>
            <div id="transaction-list" class="space-y-3 pb-20"></div>
        </div>
    </main>

    <nav class="md:hidden fixed bottom-0 inset-x-0 bg-white border-t flex justify-around p-3 z-50">
        <button onclick="switchTab('dashboard')" class="nav-btn flex flex-col items-center text-xs text-slate-500" data-target="dashboard"><i class="fa-solid fa-chart-pie text-xl mb-1"></i>Home</button>
        <button onclick="switchTab('debts')" class="nav-btn flex flex-col items-center text-xs text-slate-500" data-target="debts"><i class="fa-solid fa-credit-card text-xl mb-1"></i>N·ª£</button>
        <button onclick="switchTab('budget')" class="nav-btn flex flex-col items-center text-xs text-slate-500" data-target="budget"><i class="fa-solid fa-wallet text-xl mb-1"></i>ThuChi</button>
        <button onclick="switchTab('account')" class="nav-btn flex flex-col items-center text-xs text-slate-500" data-target="account"><i class="fa-solid fa-user-gear text-xl mb-1"></i>Account</button>
    </nav>

    <button onclick="openQuickAdd()" class="fixed bottom-20 right-4 md:bottom-8 md:right-8 z-[100] w-14 h-14 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center text-2xl hover:bg-blue-700 active:scale-90 transition-transform animate-bounce-slow">
        <i class="fa-solid fa-plus"></i>
    </button>

    <div id="toast-container" class="fixed top-5 right-5 z-[210] flex flex-col gap-2 pointer-events-none"></div>

    <div id="setup-wizard" class="hidden fixed inset-0 bg-blue-600 z-[110] flex flex-col items-center justify-center p-6 text-white transition-opacity">
        <div class="max-w-md w-full text-center">
            <div class="text-5xl mb-4"><i class="fa-solid fa-rocket"></i></div>
            <h1 class="text-3xl font-bold mb-2">Xin ch√†o!</h1>
            <p class="mb-8 opacity-90">H√£y thi·∫øt l·∫≠p th√¥ng s·ªë ban ƒë·∫ßu ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh qu·∫£n l√Ω t√†i ch√≠nh.</p>
            <div class="bg-white text-slate-800 p-6 rounded-2xl shadow-xl text-left space-y-4">
                <div><label class="block text-sm font-bold text-slate-500 mb-1">Ti·ªÅn ƒëang c√≥ (T·∫•t c·∫£ c√°c v√≠)</label><input type="number" id="initBalance" placeholder="VD: 5000000" class="w-full border-2 border-blue-100 p-3 rounded-xl text-xl font-bold text-blue-600 outline-none focus:border-blue-500"></div>
                <button onclick="finishSetup()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-500/30 transition-transform active:scale-95">B·∫Øt ƒë·∫ßu ngay <i class="fa-solid fa-arrow-right ml-2"></i></button>
            </div>
        </div>
    </div>

    <div id="custom-dialog" class="hidden fixed inset-0 bg-slate-900/60 z-[90] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100 p-6 text-center">
            <div class="mb-4 text-4xl text-blue-500" id="dialog-icon"><i class="fa-solid fa-circle-question"></i></div>
            <h3 class="text-lg font-bold text-slate-800 mb-2" id="dialog-title">X√°c nh·∫≠n</h3>
            <p class="text-slate-500 text-sm mb-4" id="dialog-msg">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán?</p>
            <input type="number" id="dialog-input" class="hidden w-full p-3 border rounded-lg mb-6 text-center font-bold text-xl outline-none focus:border-blue-500" placeholder="Nh·∫≠p s·ªë ti·ªÅn...">
            <div class="flex gap-3 justify-center" id="dialog-actions"></div>
        </div>
    </div>

    <div id="report-modal" class="hidden fixed inset-0 bg-slate-900/80 z-[80] flex items-center justify-center p-4 backdrop-blur-sm overflow-y-auto">
        <div class="bg-white rounded-xl w-full max-w-2xl shadow-2xl my-auto">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50 sticky top-0">
                <h3 class="font-bold text-lg text-slate-800"><i class="fa-solid fa-chart-pie text-blue-600"></i> B√°o c√°o Chi ti·∫øt</h3><button onclick="document.getElementById('report-modal').classList.add('hidden')" class="w-8 h-8 rounded-full hover:bg-slate-200 text-slate-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <select id="reportMonth" onchange="renderReportDetail()" class="p-2 border rounded-lg font-bold text-slate-700 outline-none focus:ring-2 ring-blue-100"></select>
                    <div class="text-right"><div class="text-xs text-slate-500">D∆∞ cu·ªëi th√°ng</div><div class="text-xl font-bold text-green-600" id="report-savings">0 ‚Ç´</div></div>
                </div>
                <h4 class="font-bold text-xs text-slate-400 uppercase mb-3">Top Chi Ti√™u</h4><div id="report-breakdown" class="space-y-3 mb-6"></div> 
                <h4 class="font-bold text-xs text-slate-400 uppercase mb-3">D√≤ng ti·ªÅn</h4><div class="h-4 bg-slate-100 rounded-full overflow-hidden flex mb-2" id="report-bar"></div>
                <div class="flex justify-between text-sm font-medium text-slate-600"><span id="report-in" class="text-green-600">Thu: 0</span><span id="report-out" class="text-red-600">Chi: 0</span></div>
            </div>
        </div>
    </div>

    // PATCH_v2
    <div id="modal" class="hidden fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-xl w-full max-w-md shadow-2xl overflow-hidden transform transition-all scale-100 flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50"><h3 class="font-bold text-lg text-slate-800" id="modal-title">Kho·∫£n vay m·ªõi</h3><button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 text-slate-500"><i class="fa-solid fa-xmark"></i></button></div>
            <form onsubmit="handleSaveLoan(event)" class="p-5 space-y-4 overflow-y-auto">
                <input type="hidden" id="loanId">
                
                <div><label class="block text-xs font-bold text-slate-500 mb-1">T√™n kho·∫£n vay <span class="text-red-500">*</span></label><input type="text" id="loanName" placeholder="VD: Mua iPhone, Vay Home Credit..." class="w-full border p-2 rounded-lg outline-none font-bold focus:border-blue-500" required></div>
                
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">S·ªë ti·ªÅn vay (G·ªëc) <span class="text-red-500">*</span></label>
                    <div class="relative"><input type="text" inputmode="numeric" id="loanAmount" oninput="calcLoanPreview()" placeholder="0" class="w-full border p-3 rounded-lg font-mono font-bold text-lg outline-none focus:border-blue-500 pr-8" required><span class="absolute right-3 top-3.5 text-slate-400 text-xs font-bold">‚Ç´</span></div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div><label class="block text-xs font-bold text-slate-500 mb-1">K·ª≥ h·∫°n (Th√°ng) <span class="text-red-500">*</span></label><input type="number" id="loanTerm" oninput="calcLoanPreview()" placeholder="12" class="w-full border p-2 rounded-lg outline-none focus:border-blue-500" required></div>
                    <div><label class="block text-xs font-bold text-slate-500 mb-1">L√£i su·∫•t (%/NƒÉm)</label><input type="number" id="loanRate" oninput="calcLoanPreview()" placeholder="0" step="0.1" class="w-full border p-2 rounded-lg outline-none focus:border-blue-500"></div>
                </div>

                <div id="loan-preview" class="bg-blue-50 p-3 rounded-xl border border-blue-100 hidden">
                    <div class="flex justify-between items-center mb-1"><span class="text-xs text-blue-600">D·ª± ki·∫øn tr·∫£ h√†ng th√°ng:</span><span class="font-bold text-blue-800" id="prev-emi">0 ‚Ç´</span></div>
                    <div class="flex justify-between items-center"><span class="text-xs text-slate-400">T·ªïng l√£i d·ª± ki·∫øn:</span><span class="font-bold text-slate-500 text-xs" id="prev-interest">0 ‚Ç´</span></div>
                </div>

                <div class="grid grid-cols-2 gap-3 pt-2 border-t">
                    <div><label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">H·∫°n tr·∫£ (H√†ng th√°ng)</label>
                    <select id="loanDay" class="w-full p-2 bg-slate-50 border rounded-lg outline-none text-sm font-bold"></select></div>
                    <div><label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">Ng√†y gi·∫£i ng√¢n (Optional)</label><input type="date" id="loanStart" class="w-full p-2 bg-slate-50 border rounded-lg outline-none text-sm"></div>
                </div>
                <div><label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase">M√£ H·ª£p ƒê·ªìng (Optional)</label><input type="text" id="loanCode" placeholder="VD: HC-2025..." class="w-full p-2 bg-slate-50 border rounded-lg outline-none text-sm font-mono"></div>

                <button type="submit" id="btn-save-loan" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 shadow-lg mt-2 disabled:bg-slate-300 disabled:cursor-not-allowed transition-all">L∆∞u Kho·∫£n Vay</button>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>